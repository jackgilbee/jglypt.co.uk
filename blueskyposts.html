<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://cdn.jsdelivr.net/npm/@twemoji/api@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#161616">
    <title>Bluesky Posts — jglypt</title>
    <meta name="description" content="All of jglypt (Jack)'s Bluesky posts on one page">
    <meta name="keywords" content="bluesky posts, Jack, jglypt">
    <meta name="author" content="Jack">
    <link href="/src/styles/styles.css" rel="stylesheet">
    <script src="/src/scripts/settings.js"></script>
    <script src="/src/scripts/dropDownMenu.js"></script>
    <script src="/src/scripts/mobileMenu.js"></script>
    <link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/src/favicons/apple-touch-icon.png">
    <link rel="apple-touch-icon" type="image/png" sizes="512x512" href="/src/favicons/icon-512.png">
    <link rel="apple-touch-icon" type="image/png" sizes="192x192" href="/src/favicons/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/src/favicons/icon-512.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/src/favicons/icon-192.png">
    <link rel="manifest" href="/src/favicons/site.webmanifest">
    <script src="https://bluesky-posts.k67f2fmjmj.workers.dev/"></script>
</head>

<body class="boxAlignment ">
    <header>
        <nav>
            <menu class="navWrapper">
                <li>
                    <a class="navButton" href="/"><img draggable="false" class="emoji" alt=""
                            src="/src/images/emojis/house.svg"> Home</a>
                </li>
                <li>
                    <a class="navButton" href="contact"><img draggable="false" class="emoji" alt=""
                            src="/src/images/emojis/speak.svg"> Socials!</a>
                </li>
                <li>
                    <a class="navButton right-link" href="settings"><img draggable="false" class="emoji" alt=""
                            src="/src/images/emojis/setttings.svg"> Settings</a>
                </li>
            </menu>
            <menu class="navWrapperMobile">
                <li>
                    <a class="navButton" href="/">jglypt.co.uk</a>
                </li>
                <li>
                    <button onclick="toggleMenu()" type="button" class="navButton right-link">
                        <img draggable="false" class="emoji" alt="" src="/src/images/icons/menu.svg">
                        Menu
                    </button>
                </li>
            </menu>
            <menu class="mobileMenu" id="mobileMenuID">
                <li>
                    <a class="navButton activeChoice" href="projects"><img draggable="false" class="emoji" alt=""
                            src="/src/images/emojis/tools.svg"> Projects</a>
                </li>
                <li>
                    <a class="navButton" href="contact"><img draggable="false" class="emoji" alt=""
                            src="/src/images/emojis/speak.svg"> Socials!</a>
                </li>
                <li>
                    <a class="navButton" href="settings"><img draggable="false" class="emoji" alt=""
                            src="/src/images/emojis/setttings.svg"> Settings</a>
                </li>
              
            </menu>
        </nav>
    </header>
        <main>
            <div id="bluesky-feed" class="bluesky-feed">
                <!-- Posts will be inserted here by the JavaScript -->
            </div>
        </main>
        <script>
  async function loadBlueskyPosts() {
    const workerUrl = 'https://bluesky-posts.k67f2fmjmj.workers.dev/'; // Replace with your Cloudflare worker URL
    try {
      const response = await fetch(workerUrl);
      if (response.ok && response.headers.get("Content-Type").includes("application/json")) {
        const posts = await response.json();
        const container = document.getElementById('bluesky-feed');
        container.innerHTML = ''; // Clear existing content
        // Process and display each post
        posts.forEach(post => {
          const postElement = document.createElement('div');
          postElement.classList.add('post');

          if (post.title) {
            const titleElement = document.createElement('h2');
            titleElement.textContent = parseCDATA(post.title) || "Untitled"; // Parse CDATA content
            postElement.appendChild(titleElement);
          }

          if (post.description) {
            const descriptionElement = document.createElement('p');
            descriptionElement.innerHTML = parseCDATA(post.description); // Parse CDATA content
            postElement.appendChild(descriptionElement);
          }

          const postInfoElement = document.createElement('div');
          postInfoElement.classList.add('post-info');

          if (post.pubDate) {
            const dateElement = document.createElement('p');
            dateElement.classList.add('post-date'); // Add class for styling
            dateElement.textContent = formatDate(post.pubDate);
            postInfoElement.appendChild(dateElement);
          }

          if (post.link) {
            const linkUrl = parseCDATA(post.link); // Parse CDATA content
            const linkElement = document.createElement('a');
            linkElement.href = linkUrl;
            linkElement.textContent = "Read more";
            linkElement.target = "_blank"; // Open link in new tab
            postInfoElement.appendChild(linkElement);
          }

          postElement.appendChild(postInfoElement);

          container.appendChild(postElement);
        });
      } else {
        console.error('Response not OK or not JSON:', response);
      }
    } catch (error) {
      console.error('Failed to load posts:', error);
    }
  }

  function parseCDATA(content) {
    const startIdx = content.indexOf('<![CDATA[');
    const endIdx = content.indexOf(']]>');
    if (startIdx !== -1 && endIdx !== -1) {
      return content.substring(startIdx + 9, endIdx); // Extract content within CDATA tags
    } else {
      return content; // Return original content if no CDATA tags found
    }
  }

  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
  }

  document.addEventListener('DOMContentLoaded', loadBlueskyPosts);
        </script>
      
    <footer class="footer">
        <p>© Copyright 2024 by Jack unless stated otherwise. This project uses the MIT license.</p>
        <p>Twemoji by Twitter Inc/X Corp is licensed under CC-BY 4.0.</p>
    </footer>
</body>

</html>